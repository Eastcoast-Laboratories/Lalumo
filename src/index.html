<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Musici</title>
  <!-- Scripts and styles will be injected by webpack -->
</head>
<body>

  <main x-data="app()" x-init="init()" @click="initAudio()" class="container">
    
    <!-- Username Prompt Modal -->
    <div class="modal-overlay" x-show="showUsernamePrompt" x-transition>
      <div class="modal-content" @click.outside="setUsername()">
        <h3>Welcome to Musici!</h3>
        <div class="mascot-welcome">
          <img src="/images/mascot.svg" alt="Musici Mascot" class="mascot" />
          <p>Let's create a special name just for you!</p>
        </div>
        <button class="primary-button" @click="setUsername()">Generate Random Name</button>
        <div class="modal-footer">
          <p class="note">Your progress will be saved automatically</p>
        </div>
      </div>
    </div>

    <!-- Hamburger Menu -->
    <div class="hamburger-container" :class="{ 'menu-open': menuOpen, 'desktop-menu': window.innerWidth >= 1024 }" x-init="window.innerWidth >= 1024 ? menuOpen = true : menuOpen = false; window.addEventListener('resize', () => { if(window.innerWidth >= 1024) menuOpen = true; })">
      <button class="hamburger-button" @click="menuOpen = !menuOpen">
        <div class="hamburger-icon">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </button>
      
      <!-- Menu content -->
      <div class="menu-content" x-show="menuOpen" @click.away="window.innerWidth < 1024 ? menuOpen = false : null" x-transition>
        <h2>Musici</h2>
        <div class="user-profile" x-show="username">
          <div class="user-avatar">
            <span x-text="username ? username.charAt(0) : '?'"></span>
          </div>
          <div class="user-name">
            <span x-text="username"></span>
          </div>
        </div>
        
        <div class="menu-chapters">
          <h3>Chapters</h3>
          <button @click="$data.active = 'pitches'; window.innerWidth < 1024 ? menuOpen = false : null" :class="{ 'active': active === 'pitches' }">Pitches & Melodies</button>
          <button @click="$data.active = 'tonecolors'; window.innerWidth < 1024 ? menuOpen = false : null" :class="{ 'active': active === 'tonecolors' }" style="display: none;">Tone Colors</button>
          <button @click="$data.active = 'rhythms'; window.innerWidth < 1024 ? menuOpen = false : null" :class="{ 'active': active === 'rhythms' }" style="display: none;">Rhythm</button>
          <button @click="$data.active = 'chords'; window.innerWidth < 1024 ? menuOpen = false : null" :class="{ 'active': active === 'chords' }" style="display: none;">Chords</button>
          <button @click="$data.active = 'freeplay'; window.innerWidth < 1024 ? menuOpen = false : null" :class="{ 'active': active === 'freeplay' }" style="display: none;">Free Play</button>
          
          <h3 class="settings-header">Settings</h3>
          <button @click="$data.active = 'settings'; window.innerWidth < 1024 ? menuOpen = false : null" :class="{ 'active': active === 'settings' }">
            <span>Player Settings</span>
          </button>
        </div>
        
        <template x-if="active === 'pitches'">
          <div class="menu-activities">
            <h3>Activities</h3>
            <button 
              @click="$dispatch('set-pitch-mode', 'listen'); window.innerWidth < 1024 ? menuOpen = false : null"
              x-data="{ isActive: false }"
              x-init="$watch('$store.pitchMode', value => isActive = value === 'listen')"
              :class="{ 'active': isActive }"
            >Listen to Melodies</button>
            <button 
              @click="$dispatch('set-pitch-mode', 'match'); window.innerWidth < 1024 ? menuOpen = false : null"
              x-data="{ isActive: false }"
              x-init="$watch('$store.pitchMode', value => isActive = value === 'match')"
              :class="{ 'active': isActive }"
            >Match Sounds</button>
            <button 
              @click="$dispatch('set-pitch-mode', 'draw'); window.innerWidth < 1024 ? menuOpen = false : null"
              x-data="{ isActive: false }"
              x-init="$watch('$store.pitchMode', value => isActive = value === 'draw')"
              :class="{ 'active': isActive }"
            >Draw a Melody</button>
            <button 
              @click="$dispatch('set-pitch-mode', 'guess'); window.innerWidth < 1024 ? menuOpen = false : null"
              x-data="{ isActive: false }"
              x-init="$watch('$store.pitchMode', value => isActive = value === 'guess')"
              :class="{ 'active': isActive }"
            >Guess Next Note</button>
            <button 
              @click="$dispatch('set-pitch-mode', 'memory'); window.innerWidth < 1024 ? menuOpen = false : null"
              x-data="{ isActive: false }"
              x-init="$watch('$store.pitchMode', value => isActive = value === 'memory')"
              :class="{ 'active': isActive }"
            >Memory Game</button>
          </div>
        </template>
      </div>
    </div>

    <!-- Chapter: Pitches -->
    <section x-show="active === 'pitches'" x-transition>
      <div x-data="pitches" x-init="init()">
        <div class="mascot-container">
          <img src="/images/mascot.svg" alt="Musici Mascot" class="mascot" @click="showMascotMessage('Hi there! I\'m your music friend. Click on the activities to learn about music!')" />
          <div class="speech-bubble" x-show="mascotMessage" x-text="mascotMessage" x-transition></div>
        </div>
        
        <!-- Progress Garden Visualization -->
        <div class="progress-garden">
          <div class="progress-label">Your Music Garden:</div>
          <div class="garden-plants">
            <div class="garden-plant" x-bind:style="'height: ' + (progress.listen/2 + 20) + '%'" title="Listening Progress">
              <span>üéµ</span>
            </div>
            <div class="garden-plant" x-bind:style="'height: ' + (progress.match/2 + 20) + '%'" title="Matching Progress">
              <span>üéπ</span>
            </div>
            <div class="garden-plant" x-bind:style="'height: ' + (progress.draw/2 + 20) + '%'" title="Drawing Progress">
              <span>üñåÔ∏è</span>
            </div>
            <div class="garden-plant" x-bind:style="'height: ' + (progress.guess/2 + 20) + '%'" title="Guessing Progress">
              <span>‚ùì</span>
            </div>
            <div class="garden-plant" x-bind:style="'height: ' + (progress.memory/2 + 20) + '%'" title="Memory Progress">
              <span>üß†</span>
            </div>
          </div>
        </div>
        <h2>Pitches and Melodies</h2>
        
        <!-- Listening Mode -->
        <div x-show="mode === 'listen'" class="pitch-activity">
          <h3>Listen to different melodies!</h3>
          <p>Click on each picture to hear what that melody sounds like:</p>
          
          <div class="pitch-grid">
            <div class="pitch-card" @click="playSequence('up')" :class="{ active: currentAnimation === 'up' }">
              <div class="pitch-icon up">
                <img src="/images/rocket.svg" alt="Rocket going up" />
              </div>
              <p>Going Up</p>
            </div>
            
            <div class="pitch-card" @click="playSequence('down')" :class="{ active: currentAnimation === 'down' }">
              <div class="pitch-icon down">
                <img src="/images/slide.svg" alt="Slide going down" />
              </div>
              <p>Going Down</p>
            </div>
            
            <div class="pitch-card" @click="playSequence('wave')" :class="{ active: currentAnimation === 'wave' }">
              <div class="pitch-icon wave">
                <img src="/images/wave.svg" alt="Wave pattern" />
              </div>
              <p>Wavy Pattern</p>
            </div>
            
            <div class="pitch-card" @click="playSequence('jump')" :class="{ active: currentAnimation === 'jump' }">
              <div class="pitch-icon jump">
                <img src="/images/frog.svg" alt="Jumping frog" />
              </div>
              <p>Jumping Notes</p>
            </div>
          </div>
        </div>
        
        <!-- Matching Mode -->
        <div x-show="mode === 'match'" class="pitch-activity">
          <h3>Match the sound to the picture!</h3>
          <p>Listen to the melody and tap the matching picture:</p>
          
          <button class="play-button" @click="setupMatchingMode()">
            <span>Play Melody</span> üîä
          </button>
          
          <div class="pitch-grid">
            <div class="pitch-card" @click="checkMatch('up')">
              <div class="pitch-icon up">
                <img src="/images/rocket.svg" alt="Rocket going up" />
              </div>
              <p>Going Up</p>
            </div>
            
            <div class="pitch-card" @click="checkMatch('down')">
              <div class="pitch-icon down">
                <img src="/images/slide.svg" alt="Slide going down" />
              </div>
              <p>Going Down</p>
            </div>
            
            <div class="pitch-card" @click="checkMatch('wave')">
              <div class="pitch-icon wave">
                <img src="/images/wave.svg" alt="Wave pattern" />
              </div>
              <p>Wavy Pattern</p>
            </div>
            
            <div class="pitch-card" @click="checkMatch('jump')">
              <div class="pitch-icon jump">
                <img src="/images/frog.svg" alt="Jumping frog" />
              </div>
              <p>Jumping Notes</p>
            </div>
          </div>
          
          <div x-show="showFeedback" class="feedback-message" x-text="feedback"></div>
        </div>
        
        <!-- Drawing Mode -->
        <div x-show="mode === 'draw'" class="pitch-activity">
          <h3>Draw a melody!</h3>
          <p>Draw a line with your finger or mouse. The app will play your melody!</p>
          
          <div class="drawing-container">
            <canvas class="drawing-canvas" width="400" height="200"
                   @mousedown="startDrawing" 
                   @mousemove="draw" 
                   @mouseup="endDrawing"
                   @touchstart="startDrawing" 
                   @touchmove="draw" 
                   @touchend="endDrawing">
            </canvas>
            
            <div class="drawing-notes">
              <div class="high-note">High Notes</div>
              <div class="low-note">Low Notes</div>
            </div>
          </div>
          
          <button class="clear-button" @click="drawPath = []; setupDrawingMode()">Clear & Try Again</button>
        </div>
        
        <!-- Guessing Mode -->
        <div x-show="mode === 'guess'" class="pitch-activity">
          <h3>What comes next?</h3>
          <p>Listen to the start of a melody, then guess if the next note goes up or down!</p>
          
          <button class="play-button" @click="setupGuessingMode()">
            <span>Play Melody</span> üîä
          </button>
          
          <div class="guess-options">
            <button class="guess-button up" @click="checkGuess('up')">
              <span>Up</span> ‚¨ÜÔ∏è
            </button>
            <button class="guess-button down" @click="checkGuess('down')">
              <span>Down</span> ‚¨áÔ∏è
            </button>
          </div>
          
          <div x-show="showFeedback" class="feedback-message" x-text="feedback"></div>
        </div>
        
        <!-- Memory Mode -->
        <div x-show="mode === 'memory'" class="pitch-activity">
          <h3>Remember the melody!</h3>
          <p>Listen to the melody, then tap the colored buttons in the same order!</p>
          
          <button class="play-button" @click="playMemorySequence()">
            <span>Play Melody Again</span> üîä
          </button>
          
          <div class="memory-grid">
            <button class="memory-button c4" @click="addToSequence('C4')">C</button>
            <button class="memory-button d4" @click="addToSequence('D4')">D</button>
            <button class="memory-button e4" @click="addToSequence('E4')">E</button>
            <button class="memory-button f4" @click="addToSequence('F4')">F</button>
            <button class="memory-button g4" @click="addToSequence('G4')">G</button>
          </div>
          
          <div class="sequence-progress">
            <template x-for="(_, index) in userSequence" :key="index">
              <div class="progress-dot active"></div>
            </template>
            
            <template x-for="(_, index) in Array(Math.max(0, currentSequence.length - userSequence.length))" :key="index">
              <div class="progress-dot"></div>
            </template>
          </div>
          
          <div x-show="showFeedback" class="feedback-message" x-text="feedback"></div>
        </div>
      </div>
    </section>

    <!-- Chapter: Tone Colors -->
    <section x-show="active === 'tonecolors'" x-transition>
      <div x-data="tonecolors" x-init="init()">
        <h2>Discover Tone Colors</h2>
        <div class="tone-grid">
          <div class="tone-card" @click="pick('warm')">
            <div class="tone-icon warm"></div>
            <p>Warm</p>
          </div>
          <div class="tone-card" @click="pick('cold')">
            <div class="tone-icon cold"></div>
            <p>Cold</p>
          </div>
          <div class="tone-card" @click="pick('soft')">
            <div class="tone-icon soft"></div>
            <p>Soft</p>
          </div>
          <div class="tone-card" @click="pick('sharp')">
            <div class="tone-icon sharp"></div>
            <p>Sharp</p>
          </div>
        </div>
        <div x-show="selected" class="feedback">
          <p>You selected: <span x-text="selected"></span></p>
        </div>
      </div>
    </section>

    <!-- Chapter: Rhythms -->
    <section x-show="active === 'rhythms'" x-transition>
      <div x-data="rhythms">
        <h2>Experience Rhythm</h2>
        <p>Coming soon...</p>
      </div>
    </section>

    <!-- Chapter: Chords -->
    <section x-show="active === 'chords'" x-transition>
      <div x-data="chords">
        <h2>Feel the Chords</h2>
        <p>Coming soon...</p>
      </div>
    </section>

    <!-- Chapter: Free Play -->
    <section x-show="active === 'freeplay'" x-transition>
      <div x-data="freeplay">
        <h2>Free Sound Play</h2>
        <p>Coming soon...</p>
      </div>
    </section>
    
    <!-- Settings Page -->
    <section x-show="active === 'settings'" x-transition class="settings-page">
      <h2>Player Settings</h2>
      
      <div class="settings-card">
        <h3>Player Profile</h3>
        <div class="profile-info" x-show="username">
          <div class="profile-header">
            <div class="large-avatar">
              <span x-text="username ? username.charAt(0) : '?'"></span>
            </div>
            <div class="profile-name">
              <h4>Your Name</h4>
              <p x-text="username"></p>
            </div>
          </div>
          
          <button class="primary-button" @click="setUsername()">Generate New Name</button>
        </div>
      </div>
      
      <div class="settings-card">
        <h3>Save Your Progress</h3>
        <p>Get a special code to save your progress. You can use this code on another device or if you need to reinstall the app.</p>
        
        <div x-data="{ saveCode: '', showCode: false }">
          <button class="primary-button" @click="saveCode = exportProgress(); showCode = true;">Generate Save Code</button>
          
          <div x-show="showCode" class="save-code-container">
            <p>Copy this code somewhere safe:</p>
            <div class="save-code" x-text="saveCode"></div>
          </div>
        </div>
      </div>
      
      <div class="settings-card">
        <h3>Load Progress</h3>
        <p>Enter a save code to restore your progress:</p>
        
        <div x-data="{ loadCode: '', loadResult: '' }">
          <textarea class="code-input" placeholder="Paste your save code here" x-model="loadCode"></textarea>
          
          <button class="primary-button" @click="loadResult = importProgress(loadCode) ? 'Success! Your progress has been restored.' : 'Sorry, that code did not work. Please check and try again.';">Load Progress</button>
          
          <p x-show="loadResult" x-text="loadResult" class="load-result"></p>
        </div>
      </div>
    </section>
  </main>

</body>
</html>
