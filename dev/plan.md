# Referrals System Redesign Plan

## Notes
- User wants to keep a single unlock flag: `areAllActivitiesUnlocked`.
- This flag should unlock three specific activities: "Draw a Melody", "Memory Game" (both in Pitches), and "Chord Story Characters" (in Chords).
- The entire Chords chapter should NOT be unlocked, only these activities.
- UI text in referrals.html and menus must reflect new unlock logic.
- Each of the three activities should have a second, always-unlocked debug button with class `debug-element`.
- Only remove the debug-element main Chords button, not the main Chords chapter button itself; menu should auto-open 2_2 if only one subitem is present.
- Refactor Chords activities: ensure correct lock/unlock logic and debug buttons after menu changes.
- Update referral-related UI strings in both English and German resource files.
- Deployment tested; F-Droid badge image still inaccessible due to double homepage/homepage in URL. Need to fix image path in template or webpack config.
- F-Droid badge image path fixed in template; verified accessible locally and in production.
- User requested to update homepage feature description to mention palm rejection for multitouch.
- F-Droid metadata (com.lalumo.app.yml) is now auto-generated by F-Droid; only license and open source compliance needed in the app itself.
- User requested to add license information to AndroidManifest.xml for F-Droid compliance.
- User requested to generate metadata/com.lalumo.app.yml for F-Droid submission with current version info (3.0, versionCode 26).
- New bug/feature: In 2_5 chord characters, after entering from nav, activity should always start in free mode; first time play is hit, it switches to game mode.
- Cleaning up audio resources on window blur deletes the synth when window loses focus, which is not desired. Only clean up on appropriate lifecycle events (e.g. visibilitychange, beforeunload), not blur.
- New bug/feature: In 2_2 chords stable/instable, after entering from nav, activity should always start in free mode; first time play is hit, it switches to game mode. Play button should reliably switch to game mode, and activity should reset to free mode when re-entered from nav.

## Task List
- [x] Update concept documentation to specify single-flag/multi-activity unlock
- [x] Update referrals.html text to describe new unlock system
- [x] Update menu and activity access logic to use `areAllActivitiesUnlocked` for the three activities
- [x] Add a debug button (class `debug-element`) for each of the three activities, always visible/unlocked
- [x] Test that only the three activities are unlocked by referrals, not the entire Chords chapter
- [x] Test debug buttons for all three activities
- [x] Fix lock/unlock logic and debug buttons for Chords activities
- [x] Update referral UI strings in English and German resource files
- [x] Fix webpack to correctly deploy homepage static images
- [x] Test deployment and homepage image accessibility on production
- [x] Fix F-Droid badge image path (avoid double homepage/) and verify accessibility
- [x] Update homepage feature description to mention palm rejection (multitouch)
- [x] Add license information to AndroidManifest.xml for F-Droid
- [x] Generate metadata/com.lalumo.app.yml for F-Droid submission
- [x] Fix 2_5 chord characters: always start in free mode when entered from nav; switch to game mode on first play
- [ ] Refine audio cleanup lifecycle logic to avoid deleting synth on window blur
- [ ] Fix 2_2 chords stable/instable: always start in free mode when entered from nav; reliably switch to game mode on play button, and reset to free mode when re-entered from nav
  - [ ] Update play button in HTML to call playStableInstableChord($data, false) to reliably start game mode
  - [ ] Test that entering from nav always starts in free mode, and play button switches to game mode

## Current Goal
Fix 2_2 chords stable/instable free/game mode logic